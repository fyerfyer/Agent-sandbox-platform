syntax = "proto3";
package agent;
option go_package = "platform/internal/agentproto";

service AgentService {
  // Configure the agent with system prompt, tools, and settings.
  // Must be called before RunStep to set up the agent for a session.
  rpc Configure (ConfigureRequest) returns (ConfigureResponse);

  // Main entry point: run an agent step with user input.
  rpc RunStep (RunRequest) returns (stream AgentEvent);

  // Stop/interrupt a running agent step.
  rpc Stop (StopRequest) returns (StopResponse);

  // Health check.
  rpc Health (Ping) returns (Pong);
}

message ConfigureRequest {
  string session_id = 1;
  string system_prompt = 2;
  repeated ToolDef tools = 3;           // additional tool definitions
  map<string, string> agent_config = 4; // e.g. {"max_loops":"10","agent_type":"react"}
  repeated string builtin_tools = 5;    // names of built-in tools to enable: "bash","file_read","file_write","list_files"
}

message ConfigureResponse {
  bool success = 1;
  string message = 2;
  repeated string available_tools = 3;  // tool names that are now active
}

message ToolDef {
  string name = 1;
  string description = 2;
  string parameters_json = 3; // JSON Schema describing the tool parameters
}

message RunRequest {
  string session_id = 1;
  string input_text = 2;
  map<string, string> env_vars = 3;
}

message StopRequest {
  string session_id = 1;
}

message StopResponse {
  bool success = 1;
  string message = 2;
}

enum EventType {
  EVENT_TYPE_UNSPECIFIED = 0;
  EVENT_TYPE_THOUGHT = 1;
  EVENT_TYPE_TOOL_CALL = 2;
  EVENT_TYPE_TOOL_RESULT = 3;
  EVENT_TYPE_ANSWER = 4;
  EVENT_TYPE_ERROR = 5;
  EVENT_TYPE_STATUS = 6;     // status updates (e.g. "configuring", "tool registered")
  EVENT_TYPE_TEXT_CHUNK = 7; // streaming text chunk from LLM
}

enum ServiceStatus {
  SERVICE_STATUS_UNSPECIFIED = 0;
  SERVICE_STATUS_OK = 1;
  SERVICE_STATUS_BUSY = 2;
}

message AgentEvent {
  EventType type = 1; 
  string content = 2;
  string source = 3;
  int64 timestamp = 4;
  string metadata_json = 5;
}

message Ping {}

message Pong {
  ServiceStatus status = 1; 
}